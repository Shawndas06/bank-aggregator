# Render.com конфигурация для деплоя
# Поддерживает бесплатный тариф с ограничениями

services:
  # Web Service (Backend + Frontend вместе)
  - type: web
    name: bank-aggregator
    runtime: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free  # Бесплатный тариф
    healthCheckPath: /health
    envVars:
      # Render автоматически создаст PostgreSQL и предоставит DATABASE_URL
      # Но можно указать вручную
      - key: DATABASE_URL
        sync: false  # Укажите вручную после создания PostgreSQL
      
      # Redis - можно использовать внешний бесплатный (Upstash, Redis Cloud)
      - key: REDIS_HOST
        value: your-redis-host.upstash.io
      - key: REDIS_PORT
        value: 6379
      - key: REDIS_PASSWORD
        value: your-redis-password
        sync: false
      
      # App settings
      - key: APP_NAME
        value: Bank Aggregator API
      - key: APP_VERSION
        value: 1.0.0
      - key: DEBUG
        value: false
      - key: SECRET_KEY
        generateValue: true  # Render сгенерирует автоматически
      - key: ALGORITHM
        value: HS256
      - key: SESSION_EXPIRE_HOURS
        value: 24
      
      # CORS - обновите после получения URL
      - key: ALLOWED_ORIGINS
        value: https://your-app.onrender.com
      
      # SMTP
      - key: SMTP_HOST
        value: smtp.yandex.ru
      - key: SMTP_PORT
        value: 587
      - key: SMTP_USERNAME
        value: bagaudinh@ya.ru
      - key: SMTP_PASSWORD
        value: hsiklbtnvlhsglad
        sync: false
      - key: SMTP_FROM_EMAIL
        value: bagaudinh@ya.ru
      - key: SMTP_FROM_NAME
        value: Bank Aggregator
      - key: SMTP_ENABLED
        value: true
      
      # VTB API
      - key: TEAM_CLIENT_ID
        value: team222
      - key: TEAM_CLIENT_SECRET
        value: Wl1F0L2aVHOPE20rM0DFeqvP9Qr2pgQT
      - key: VBANK_BASE_URL
        value: https://vbank.open.bankingapi.ru
      - key: ABANK_BASE_URL
        value: https://abank.open.bankingapi.ru
      - key: SBANK_BASE_URL
        value: https://sbank.open.bankingapi.ru
      - key: BANK_TOKEN_TTL
        value: 82800
      - key: CONSENT_REQUEST_TTL
        value: 14400
      - key: BANK_DATA_CACHE_TTL
        value: 14400

  # PostgreSQL Database (бесплатный тариф)
  - type: pg
    name: bank-aggregator-db
    plan: free
    databaseName: bank_aggregator
    user: postgres

